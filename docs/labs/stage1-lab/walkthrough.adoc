:walkthrough: Matrix to Rocket.Chat bridge ()
:user-password: openshift
:namespace: {user-username}-devspaces
:invite-url: http://invite-webapp.{openshift-app-host}

:url-element: https://element-matrix.{openshift-app-host}
:url-rocketchat: https://rocketchat-rocketchat.{openshift-app-host}
:url-codeready: http://devspaces.{openshift-app-host}/
:url-devconsole: {openshift-host}/topology/ns/{namespace}

:images: {imagesdir}images

:experimental:

:cp-btn: pass:[<svg fill="currentColor" height="1em" width="1em" viewBox="0 0 448 512" aria-hidden="true" role="img" style="vertical-align: -0.125em;"> <path d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"></path></svg>]

:btn-paste: pass:[<svg fill="#000000" width="1em" height="1em" viewBox="-32 0 512 512" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M128 184c0-30.879 25.122-56 56-56h136V56c0-13.255-10.745-24-24-24h-80.61C204.306 12.89 183.637 0 160 0s-44.306 12.89-55.39 32H24C10.745 32 0 42.745 0 56v336c0 13.255 10.745 24 24 24h104V184zm32-144c13.255 0 24 10.745 24 24s-10.745 24-24 24-24-10.745-24-24 10.745-24 24-24zm184 248h104v200c0 13.255-10.745 24-24 24H184c-13.255 0-24-10.745-24-24V184c0-13.255 10.745-24 24-24h136v104c0 13.2 10.8 24 24 24zm104-38.059V256h-96v-96h6.059a24 24 0 0 1 16.97 7.029l65.941 65.941a24.002 24.002 0 0 1 7.03 16.971z"></path></g></svg>]

:pen-btn: pass:[<svg height="2em" width="2em" viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path fill="#444" d="M1 11.9l-1 4.1 4.1-1 9.2-9.2-3.1-3.1-9.2 9.2zM1.5 15l-0.4-0.5 0.4-2 2 2-2 0.5zM10.9 4.4l-8.1 8-0.6-0.6 8.1-8 0.6 0.6z"></path><path fill="#444" d="M15.3 0.7c-1.1-1.1-2.6-0.5-2.6-0.5l-1.5 1.5 3.1 3.1 1.5-1.5c0-0.1 0.6-1.5-0.5-2.6zM13.4 1.6l-0.5-0.5c0.6-0.6 1.1-0.1 1.1-0.1l-0.6 0.6z"></path></svg>]

:map-att: pass:[<svg width="1em" height="1em" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="bi bi-box-arrow-in-down-right"> \
  <path d="M6.364 2.5a.5.5 0 0 1 .5-.5H13.5A1.5 1.5 0 0 1 15 3.5v10a1.5 1.5 0 0 1-1.5 1.5h-10A1.5 1.5 0 0 1 2 13.5V6.864a.5.5 0 1 1 1 0V13.5a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5v-10a.5.5 0 0 0-.5-.5H6.864a.5.5 0 0 1-.5-.5z" /> \
  <path d="M11 10.5a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1 0-1h3.793L1.146 1.854a.5.5 0 1 1 .708-.708L10 9.293V5.5a.5.5 0 0 1 1 0v5z" /> \
</svg>]

:map-tick: pass:[<svg width="1em" height="1em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke-width="1"> \
<path d="M4.89163 13.2687L9.16582 17.5427L18.7085 8" stroke="#000000" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round"/> \
</svg>]

:map-import: pass:[<svg width="1em" height="1em" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="#FFFFFF"> \
  <path d="M16 288c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h112v-64zm489-183L407.1 7c-4.5-4.5-10.6-7-17-7H384v128h128v-6.1c0-6.3-2.5-12.4-7-16.9zm-153 31V0H152c-13.3 0-24 10.7-24 24v264h128v-65.2c0-14.3 17.3-21.4 27.4-11.3L379 308c6.6 6.7 6.6 17.4 0 24l-95.7 96.4c-10.1 10.1-27.4 3-27.4-11.3V352H128v136c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V160H376c-13.2 0-24-10.8-24-24z"/> \
</svg>]

:map-wrench: pass:[<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" \
   height="1em" fill="white" viewBox="0 0 479.79 479.79" style="enable-background:new 0 0 479.79 479.79;" \
   xml:space="preserve"> \
<g> \
  <path d="M478.409,116.617c-0.368-4.271-3.181-7.94-7.2-9.403c-4.029-1.472-8.539-0.47-11.57,2.556l-62.015,62.011l-68.749-21.768 \
    l-21.768-68.748l62.016-62.016c3.035-3.032,4.025-7.543,2.563-11.565c-1.477-4.03-5.137-6.837-9.417-7.207 \
    c-37.663-3.245-74.566,10.202-101.247,36.887c-36.542,36.545-46.219,89.911-29.083,135.399c-1.873,1.578-3.721,3.25-5.544,5.053 \
    L19.386,373.152c-0.073,0.071-0.145,0.149-0.224,0.219c-24.345,24.346-24.345,63.959,0,88.309 \
    c24.349,24.344,63.672,24.048,88.013-0.298c0.105-0.098,0.201-0.196,0.297-0.305l193.632-208.621 \
    c1.765-1.773,3.404-3.628,4.949-5.532c45.5,17.167,98.9,7.513,135.474-29.056C468.202,191.181,481.658,154.275,478.409,116.617z \
     M75.98,435.38c-8.971,8.969-23.5,8.963-32.47,0c-8.967-8.961-8.967-23.502,0-32.466c8.97-8.963,23.499-8.963,32.47,0 \
    C84.947,411.878,84.947,426.419,75.98,435.38z"/> \
</g></svg>]

:btn-download: pass:[<svg width="2em" height="2em" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><g transform="translate(128 128) scale(0.5)"><path d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"/></g></svg>]

:ico-download: pass:[<svg fill="white" width="1em" height="1em" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path d="M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"/></svg>]


:btn-stl-blue: pass:[style="display:inline-block; padding:10px 22px; background:#0366CB; color:white; font:normal 14px Arial,sans-serif; border-radius:40px; cursor:default; user-select:none; text-decoration:none;"]

// WORKS
:style-kbd: kbd { \
  color: black; \
  background-color: white; \
  border: 1px solid black; \
  box-shadow: 0px 1px black; \
  font-size: .85em; \
  line-height: .85em; \
  display: inline-block; \
  font-weight: 600; \
  letter-spacing: .05em; \
  padding: 3px 5px; \
  white-space: nowrap; \
  border-radius:5px; \
} \

:style-summary: summary {cursor: pointer; list-style: none;}
:style-triangle: .triangle {margin-right: .5em;} summary:hover .sumtext {text-decoration: underline;}
:style-details:  .triangle::before {content: "‚ñ∂";} details[open] .triangle::before {content: "‚ñº";}
:style-open-close: {style-summary}{style-triangle}{style-details} 

:style-preview: pre {background-color: #272822; color: white; padding: 5px 15px; font-size: 15px}
:style-indent: .indent2 {padding-left: 2rem;}
:style-all: pass:a[<style>{style-kbd}{style-preview}{style-indent}{style-open-close}</style>]


:url-docserver: https://docserver-webapp.{openshift-app-host}
//:url-docserver: https://docserver-webapp.apps.cluster-mqpjp.dynamic.redhatworkshops.io/
//:url-docserver: http://0.0.0.0:8080

:docserver-status: pass:a[<img hidden="true" src="invalid-image.jpg" onerror=" \
        fetch('{url-docserver}/status') \
        .then(response => response.text()) \
        .then(data => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:lime;display:inline-block&quot;></div><p>&nbsp;</p>') \
        .catch(error => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:red;display:inline-block&quot;></div><p>&nbsp;</p>') \
      ">]

:freplace: pass:[function replaceTokens(templateString, values) { \
    const valueArray = values.split(',').map(val => val.trim()); \
    let result = templateString; \
    let replaceIndex = 0; \
    while (result.includes('REPLACE') && replaceIndex < valueArray.length) { \
        result = result.replace('REPLACE', valueArray[replaceIndex]); \
        replaceIndex++; \
    } \
    return result; \
}]

:fdocserver: pass:a[function docserver(target,template,params) { \
    {freplace} \
    fetch('{url-docserver}'+params.trim()) \
        .then(response => response.text()) \
        .then(data => {target.firstChild.data=replaceTokens(text, data);}) \
        .catch(error => room = 'Error fetching data: ' + error.message); \
}]

:fcopy: pass:a[function copy(el) { \
  el.previousElementSibling.select(); \
  text = el.previousElementSibling.textContent; \
  console.log(text); \
  navigator.clipboard.writeText(text + '\n') \
        .then(response => console.log('Text with carriage return copied to clipboard!')) \
        .catch(err => console.error('Failed to copy: ', err)); \
}]

:copypaste: pass:a[ \
<div style="border: 1px solid #f0f0f0; border-bottom-color: #8a8d90; display: flex; align-items: flex-start;"> \
  <textarea readonly style="field-sizing: content;border: none; background-color: #f0f0f0; width: 100%; resize: none; font-size:14px; font-family: monospace;padding: 5px 15px" rows="1">function example() { \
  console.log("Hello {replace-with-previous}!"); \
  return true; \
}</textarea> \
  <button class="mytooltip" onclick="{fcopy} copy(this);" style="border: none; background-color: white; padding: 5px 15px; border-bottom: 1px solid transparent; transition: border-bottom-color 0.2s;"> \
    <svg fill="currentColor" height="1em" width="1em" viewBox="0 0 448 512" aria-hidden="true" role="img" style="vertical-align: -0.125em;"> \
      <path d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"></path> \
    </svg> \
    <span class="mytooltiptext">Copy to clipboard</span> \
  </button> \
  <style> \
.mytooltip{position:relative;display:inline-block;border-bottom:1px dotted black}.mytooltip .mytooltiptext{visibility:hidden;width:120px;background-color:#555;color:#fff;text-align:center;border-radius:6px;padding:5px 0;position:absolute;z-index:1;bottom:125%;left:50%;margin-left:-60px;opacity:0;transition:opacity 0.3s}.mytooltip .mytooltiptext::after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#555 transparent transparent transparent}.mytooltip:hover .mytooltiptext{visibility:visible;opacity:1} \
  </style> \
</div> \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  {fdocserver} \
  let txtarea = this.parentElement.querySelector('textarea'); \
  let div = this.closest('.paragraph'); \
  if(!div.closest('.openblock')){div = div.parentElement} \
  let source = div.nextElementSibling; \
  let pre = source.querySelector('pre'); \
  let text = pre.textContent; \
  let lineCount = text.split('\n').length; \
  let tokens = this.nextSibling; \
  console.log('tokens: [' +tokens.data.trim()+']'); \
  if(tokens.data.trim()!=''){docserver(txtarea,text,tokens.data);} else {txtarea.firstChild.data=text;} \
  source.remove(); \
  tokens.remove(); \
  this.remove(); \
  txtarea.style.height = 'auto'; \
  txtarea.style.height = (txtarea.scrollHeight) + 'px'; \
}"> \
]

:snippet: pass:a[ \
<div style="border: 1px solid #f0f0f0; border-bottom-color: #8a8d90; display: flex; align-items: flex-start;"> \
</div> \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  {freplace} \
  let block = this.closest('.openblock'); \
  let div = this.closest('.paragraph'); \
  let source = div.nextElementSibling; \
  let pre = source.querySelector('pre'); \
  let text = pre.textContent; \
  let lineCount = text.split('\n').length; \
  let tokens = this.nextSibling; \
  tokens.data = tokens.data.replace('user','room'); \
  console.log('tokens: [' +tokens.data.trim()+']'); \
  console.log('before text: [' +text+']'); \
  text = replaceTokens(text, tokens.data.trim()); \
  pre.textContent = text; \
  console.log('after text: [' +text+']'); \
  console.log(block); \
  block.parentElement.insertBefore(pre,block); \
  block.remove(); \
}"> \
]


:room: pass:a[ \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  let code = this.previousElementSibling; \
  let text = code.textContent; \
  console.log('before text: [' +text+']'); \
  text = text.replace('user', 'room'); \
  code.textContent = text; \
  console.log('after text: [' +text+']'); \
  this.remove(); \
}"> \
]

ifdef::env-github[]
endif::[]

[id='lab1-camel']
= Lab 1 - (b) - Be the Camel developer

Impersonate the Camel developer to complete Lab-1's Matrix to Rocket.Chat processing flow.


[type=walkthroughResource,serviceName=openshift]
.Doc System
****
[subs=attributes]
++++
<div style="padding-left: 20px">{docserver-status}<div>
++++
****


Prerequisites: +
--
* Ensure you have previously completed the following tiles:
+
image::images/prereq.png[align="left", width=100%]

{empty} +
--

Technical goals and milestones:

* Develop Camel routes with low-code tools
* Define JSON data transformations.
* Use of _Camel JBang_ for fast prototyping
* Local execution and testing

{empty} +


[time=1]
[id="kaoto-overview"]
== Quick overview of Kaoto 
{style-all}

Most of the processing flows you'll construct during the workshop will be built using Kaoto, the integration designer for Apache Camel.

Kaoto is integrated in VS Code as an extension easy to find in the marketplace and install.

NOTE: The Kaoto extension is already pre-installed for you in Dev Spaces.

image::images/new/vs-code-kaoto.jpg[align="left", width=40%]

{empty} +

With Kaoto, you will define and configure many of the well known Camel constructs using its graphical user interface. Among other tasks, Kaoto will help you to:

 - Define Camel routes
 - Define Kamelets
 - Define data transformations
 - Apply EIPs (Enterprise Integration Patterns)

{empty} +

This is how Kaoto will load on your Dev Spaces IDE:

image::images/new/kaoto-overview.jpg[align="center", width=100%]

{empty} +

When you click, in the project explorer, one of the files with Camel definitions, Kaoto will open it as a tab and render it visually so that you can interact to work on the Camel constructs.

You will start using Kaoto in the next lab section to work on the Camel routes. Each Camel route defines a data flow you need to construct the solution.

{empty} +


[time=8]
[id="local"]
== Start local development 
{style-all}

[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****

For reference, here's again the processing flow to implement:

image::images/new/processing-flow.jpg[align="center", width=80%]

The Camel route will include 3 processing steps:

====
* *A source _Kamelet_* +
Consumes events from _Matrix_.

* *A data mapping* +
Transforms _Matrix_ events to _Rocket.Chat_ events (in JSON format).

* *A sink _Kamelet_* +
Produces events to _Rocket.Chat_.
====

{empty} +

[IMPORTANT] 
--
You need to already be onboarded into _Matrix_ and _Rocket.Chat_. +
Ensure you have previously completed: 

- *_Lab 1.intro - MessageHub - Scenario and Onboarding_*.
--

{empty} +

The development tool that will help us iterate our code in our local environment is _Camel JBang_.

image::images/camel-jbang.png[align="left", width=40%]

{empty} +

TIP: Camel JBang is an upstream tool for _Camel_. The tool is included in Red Hat build of Apache Camel under the name _"Camel CLI"_. +
It is an extremely useful tool for all things Camel. It simplifies many of the common tasks a Camel developer undergoes. 
 

=== Start the lab

At first, your `lab` directory is empty:

--
[.indent2]
üìÅ workshop +
&nbsp;&nbsp;üìÅ *lab* +
pass:[<mark style="padding-left: 1rem; background-color: white; color: grey"></mark>] [empty]
--

{blank}

IMPORTANT: All the commands you'll be asked to run all along the workshop are designed to be executed from your root `lab` folder. +
Stay always on your `lab` folder, there's no need to change directories.

{empty} +

From your UI terminal...

image::images/crw-terminal.png[align="left", width=100%]

{blank}

We provide below a base skeleton to get you started:

[IMPORTANT]
====
Issue the command below to officially start your lab:

--
{copypaste}
----
start
----
--

NOTE: The command will initialise the lab with a couple of files.
====



=== Your files

After initialisation, under the `lab` directory, you'll find the following source files:


--
[.indent2]
üìÅ workshop +
&nbsp;&nbsp;üìÅ lab +
&nbsp;&nbsp;&nbsp;&nbsp;üìÅ m2r +
pass:[<mark style="padding-left: 2rem; background-color: white; color: purple"><b><i>&nbsp;!&nbsp;&nbsp;</i></b></mark>] *m2r.camel.yaml* +
pass:[<mark style="padding-left: 1rem; background-color: white; color: grey"><b>‚öô</b></mark>] matrix.properties +
pass:[<mark style="padding-left: 1rem; background-color: white; color: grey"><b>‚öô</b></mark>] rocketchat.properties +

NOTE: Make sure the files are visible in your file explorer in the left panel of _VSCode_.
--

. Open in Kaoto the first Camel route. 
+
Under your `lab/m2r` directory, find and open the following flow definition:
+
--
* `m2r.camel.yaml`
--
+
{blank}
+
The image below shows the Camel route you should see in the canvas:
+
{blank}
+
[TIP]
====
Click the Horizontal layout to match the documentation pictures.

image::images/new/canvas-horizontal-layout.jpg[align="left", width=40%]
====
+
image::images/new/route-matrix-log.jpg[align="left", width=30%]
+
{blank}
+
[pass,subs=attributes]
<details>
  <summary>
    <span class="triangle"></span>
    <span class="sumtext"><b>Warning:</b> If you don't see the rendering above, install <i>Kaoto</i> manually. Click for more information</span>
  </summary>
  <div style="border: 2px solid #d0d7de; border-radius: 6px; padding: 0 12px 12px; margin: 1.5em 0;">
<p style="margin-top: 1em;">Follow the steps below to ensure your <i>Kaoto</i> extension is installed in VS Code.</br>
<ol>
  <li>Open the <i>Extensions</i> view.</li>
  <li>Find the <i>Kaoto</i> extension and click <b>Install</b>.</li>
  <li>On the confirmation prompt, click "<b>Trust Publisher &amp; Install</b>".</li>
  <li>Go back to the <i>Explorer</i> view.</li>
  <li>Click <code>m2r.camel.yaml</code> to open the file in <i>Kaoto</i>.</li>
</ol>
<img src="{images}/new/kaoto-extension-install.jpg"/>
</p></div>
</details>
+
{blank}
+
What you see above is a *_'Kamelet to Log'_* route, basically a Camel route with 2 processing steps. +
The Kamelet source _(Matrix)_ receives message notifications. The Log activity outputs the contents of the message.
+
[NOTE]
--
About the `matrix-source` _Kamelet_:

* It's not provided out of the box by Camel. It has been specifically created and deployed for this workshop.
* It's implemented following the specification of the Matrix Sync API (new Matrix's API) to consume events from the server. To know more, read its API documentation here: https://spec.matrix.org/v1.6/client-server-api/#syncing
--
+
[NOTE]
--
When inspecting the route configuration in Kaoto, you'll see the following:

* The Kamelet defines `variableReceive: matrix` to allocate the data of the incoming message (`body` is ignored).
* The route logs the incoming event using the Camel's simple expression `${variable.matrix}`.
--
+
{empty} +

. Configure the _Matrix_ credentials
+
Open in your editor your `matrix.properties` file and add the following entries:
+
--
{copypaste}/configuration/matrix/{user-username}
----
# Matrix credentials
matrix.token=REPLACE
matrix.room=REPLACE
----
--
+
NOTE: both parameters have been automatically pre-configured for your use in this lab.
+
{empty} +


. Run your YAML definition with Camel JBang
+ 
Use the following command to run locally your _Camel_ route:
+
--
{copypaste}
----
camel run \
--source-dir m2r \
--properties matrix.properties \
--local-kamelet-dir ../support/kamelets
----
--
+
NOTE: The command above includes flags to tell _Camel JBang_ where to find the resources needed (code, properties, _Kamelets_).
+
{blank}
+
_Camel JBang_ will build a local runnable and start it. +
In your terminal logs, you should see _Camel_ connecting to _Matrix_, similar to the following:
+
++++
<pre style="line-height: 1;white-space: pre-wrap"><span style="color:grey;font-family: monospace;font-size: 12px;">2025-10-30 21:59:34.277 <span style="color: limegreen">INFO</span> <span style="color: deeppink">4330</span> --- [           main] <span style="color: cyan;">.impl.engine.AbstractCamelContext</span><span style="color: white;"> : Apache Camel 4.15.0 (m2r) started in 800ms (build:0ms ...)</span>
2025-10-30 21:59:35.176 <span style="color: limegreen;">INFO</span> <span style="color: deeppink">4330</span> --- [atrix-streaming] <span style="color: cyan">matrix-source.kamelet.yaml:58</span><span style="color: white;">     : Opening connection to Matrix...</span>
2025-10-30 21:59:35.390 <span style="color: limegreen;">INFO</span> <span style="color: deeppink">4330</span> --- [atrix-streaming] <span style="color: cyan">matrix-source.kamelet.yaml:67</span><span style="color: white;">     : Matrix HTTP Streaming started</span>
</span></pre>
++++
+
[NOTE]
====
A window notification may pop up at the bottom-right corner of your screen. +
Close it, or simply ignore it, as it disappears after a few seconds.

image::images/new/che-port-8080.png[align="left", width=40%]
====
+
{empty} +
+
Now, from the _Matrix_ chat room, send a message.
+
* For example:
+
--
{copypaste}
----
Hello Camel
----
--
+
//image::images/gitter-send-message.png[align="left", width=60%]
+
[subs=attributes]
++++
<div class="matrix-flow-wrapper">
  <!-- Scoped Styles for this component -->
  <style>
    .matrix-flow-wrapper {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      background-color: white;
    }

    .platform-row {
      display: flex;
      align-items: flex-start;
      gap: 5px;
    }

    /* Icons */
    .icon-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 60px;
      text-align: center;
      flex-shrink: 0;
    }
    
    .icon-box {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 5px;
      margin-left: 15px;
      z-index: 2;
    }
    
    .icon-label {
      font-size: 18px;
      color: #000;
      font-weight: 500;
      margin-left: 15px;
    }

    .matrix-bg { background-color: #33C69D; }
    
    /* Message Bubbles (Light) */
    .msg-bubble-light {
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fcfcfc;
      width: 260px;
      padding: 0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      position: relative;
      z-index: 2;
    }
  </style>

  <!-- Main Flex Container -->
  <div style="display: flex; align-items: flex-end;">
    
    <!-- Arrow Column -->
    <div style="margin-right: 10px; margin-bottom: 40px;">
      <svg width="120" height="120" viewBox="0 0 130 180" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block;">
        <path d="M20 10H45V80C45 113.137 71.8629 140 105 140H120V120L150 150L120 180V160H105C58.0558 160 20 121.944 20 75V10Z" fill="#EDEDED" stroke="#777" stroke-width="2"/>
      </svg>
    </div>

    <!-- Content Column -->
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <div class="platform-row">
        <!-- Matrix Icon -->
        <div class="icon-container">
          <div class="icon-box matrix-bg" style="margin-top: 5px; transform: scale(1);">
            <svg width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <g transform="translate(-11 -11) scale(0.09)">
                <path stroke-width="30" d="m153.25 277.15c.47-46.35 37.79-81.6 81.6-81.6m0-42.3c46.35.47 81.6 37.79 81.6 81.6m42.3 0c-.47 46.35-37.79 81.6-81.6 81.6m0 42.3c-46.35 0-81.6-37.79-81.6-81.6"/>
              </g>
            </svg>
          </div>
          <span class="icon-label">Matrix</span>
        </div>

        <!-- Matrix Message Box -->
        <div style="border: 1px solid #ddd; border-radius: 4px; background: #fff; width: 260px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; flex-direction: column; padding: 5px 5px; gap: 2px; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
          <div style="display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background-color: #4a90e2; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; flex-shrink: 0;">
              U
            </div>
            <div style="margin-left: 12px; font-weight: bold; font-size: 15px; color: #00d781; line-height: 1;">
              {user-username}
            </div>
          </div>
          <div style="background-color: #eee; display: flex; align-items: baseline; padding: 5px 0px;">
            <div style="width: 30px; text-align: center; font-size: 10px; color: #6c757d; flex-shrink: 0;">
              21:59
            </div>
            <div style="margin-left: 12px; font-size: 15px; color: #333; line-height: .5;">
              Hello Camel
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
++++
+
{blank}
+
Your terminal should show the arrival of a _Matrix_ event similar to the following JSON payload:
+
[subs="attributes+"]
++++
<pre style="line-height: 1;white-space: pre-wrap"><span style="color:grey;font-family: monospace;font-size: 12px;">2025-10-30 21:59:55.672 <span style="color: limegreen;">INFO</span> <span style="color: deeppink">4330</span> --- [ad #7 - WireTap] <span style="color: cyan">m2r.camel.yaml:12</span><span style="color: white;">     : {"fromUser":{"username":"{user-username}","displayName":"{user-username}"},"text":"<span style="background-color: #ffff00; color: #000000; padding: 0px 0px;">Hello Camel</span>","sent":"2025-10-30T21:59:55.000Z"}</span>
</span></pre>
++++
+
NOTE: Find the message content highlighted in yellow.
+
{blank}
+
Hopefully you've been successful in capturing _Matrix_ messages with _Camel_.
+
{empty} +


. Stop Camel JBang 
+
Press kbd:[Ctrl+C], from your terminal, to stop the running _Camel_ process.
+
[TIP]
--
_Camel JBang_ also implements the following very handy commands when running multiple _Camel_ integrations:

* `camel ps` to list running _Camel_ integrations.
* `camel stop <instance_name>` to shut down a running _Camel_ integration.  
--
+
{empty} +


This completes your first iteration and execution consuming messages from _Matrix_.

In your next exercise you keep iterating, completing the flow with the following:

* Adding data transformation using Kaoto's DataMapper.
* Directing the messages to _Rocket.Chat_

{empty} +


[type=verification]
Did you see the message sent from _Matrix_ show up in your terminal?



[time=10]
[id="data-mapping"]
== Add data transformation 
{style-all}

Your next task is to add a data transformation step in your Camel route.

Kaoto comes with a visual _DataMapper_ tool you will use to define your _Matrix_ to _Rocket.Chat_ data transformation, as a first introductory exposure to the tool.


[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****


Let's get started.



. Include data transformation
+
You will extend the _Camel_ route definition by including a data transformation that matches the JSON structure the target system (_Rocket.Chat_) expects.
+
NOTE: The first time you define a data mapping, the process feels laborious. +  
With practice, you will create data mappings quickly and intuitively.
+
.. Include in your Camel route a Kaoto data transformation step
+
--
From Kaoto: 

. Click the kbd:[+] button in the transition
. Type `mapper` in the filter to find the _Kaoto DataMapper_
. Click the _Kaoto DataMapper_ tile
. Click the mapper to open the configuration panel
. Click the pass:a[<span {btn-stl-blue}>{map-wrench}  Configure</span>] button

image::images/new/canvas-create-mapper.jpg[align="left", width=100%]



When you create and open a new mapping definition, you will find it empty. +
The picture belows shows some of the main parts you will interact with:

image::images/new/mapper-empty.png[align="left", width=100%]

{empty} +

--
+
.. Next, define the inputs and outputs
+
--
From the DataMapper editor: 

. Define the source:
.. On **Parameters** click the button kbd:[+] to add new parameter
.. Enter `matrix` and click the checkmark button kbd:[{map-tick}]
.. Click kbd:[{map-att}] (Attach schema), next click 
pass:a[<span {btn-stl-blue}>{map-import}</span>] and then pick at the top of your screen: `support/schemas/*matrix-in.json*`.
.. Click pass:a[<span {btn-stl-blue}>Attach</span>] to complete the action.
+
{blank}
+
. Define the target
.. On the right hand side of the DataMapper screen: +
Click kbd:[{map-att}] (Attach schema), next click 
pass:a[<span {btn-stl-blue}>{map-import}</span>] and then pick at the top of your screen: `support/schemas/*rocketchat-out.json*`.
.. Click pass:a[<span {btn-stl-blue}>Attach</span>] to complete the action.

{empty} +

Once your in and out schemas have been attached your DataMapper should look as follows:

image::images/new/mapper-m2r.png[align="center", width=90%]

--
+
{empty} +
+
.. Define the data mappings from source to target
+
Copy and Paste (in the *Target*) the values below to define the given field entries:
+
... `string[@key = channel]`: 
+
--
{copypaste}/roomid/{user-username}
----
"REPLACE"
----
--
+
[TIP]
====
To paste the value, click `‚†á` and select **Add selector expression**, as shown below:

image::images/new/mapper-add-expression.jpg[align="left", width=60%]
====
+
{blank}
+
... `string[@key = text]`:
+
To map the field, click and drag kbd:[string [@key = text\]] from the source (left) to the target (right).
+
A connection will be created between source and target, rendered as follows:
+
image::images/new/mapper-text.jpg[align="left", width=80%]
+
{empty} +
+
.. Refine the mapping by using a function
+
The last mapping above simply copies the message from source to target, as in the _hello_ example below:
+
--
* `hello` -> `hello`
--
+
{blank}
+
However, we want to see in Rocket.Chat information about the user and origin. +
It means the mapping would need to happen as follows:
+
--
* `hello` -> `*{user-username}@matrix:* hello`
+
NOTE: The message above includes **bold** letters. +
As the target system understands _Markdown_, we will use it to format the message, as follows: +
`pass:a[*{user-username}@matrix:* hello]`
--
+
For the result above to happen, the following concatenation of segments needs to occur:
+
====
* `*`: the _Markdown_ symbol to start a bold string 
* `{user-username}`: from the source field *username*
* ``@matrix:* ``: the originating system and the closing _Markdown_ symbol 
* `hello`: from the source field *text*
====
+
{blank}
+
All the segments above can be concatenated in the Data Mapper using the XPath function `concatenate`.
+
NOTE: XPath is a simple language for finding and selecting specific parts in a data structure. The language comes with many handy out-of-the-box functions.
+
Open the XPath editor by clicking kbd:[{pen-btn}] at the end of the row.
+
image::images/new/mapper-xpath-editor-view.png[align="left", width=80%]
+
{blank}
+
On the left you'll find fields and functions you can drag and drop into the blue text area. +
You'll find in the text blue area the current mapping expression for the target field kbd:[string[@key = text\]] (text in Rocket.Chat).
+
You're going to perform 2 actions:
+
--
. Define the string segments (as explained earlier)
. Wrap the segments with a `concatenate` function
--
+
{empty} +
+
Let's start with 1. Define the segments:
+
[NOTE]
====
The *preview* below shows the expected outcome of the actions you're about to do: 

++++
<div style="background:#EAFAFA; padding:15px 15px 15px 8px; border-radius:8px; font-family:Consolas,monospace; font-size:14px; line-height:1.6; position:relative;">
  <pre style="margin:0; background:#EAFAFA; padding-left:50px; border:none; outline:none;">
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">1</span><span style="color:#000;">'*'</span>
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">2</span><span style="color:#000;">, $matrix-x/fn:map/fn:map[@key='fromUser']/fn:string[@key='username'],</span>
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">3</span><span style="color:#000;">'@matrix:* '</span>
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">4</span><span style="color:#000;">, $matrix-x/fn:map/fn:string[@key='text']</span></pre>
</div>
++++
====
+
====
[lowerroman]
. Delete current expression (blue text area empty).
. Copy and paste:
+
--
{copypaste}
----
'*'
----
--
+
. Drag and drop from the left to the editor +
kbd:[string [@key = username\]] -> `editor`
+
{blank}
+
. Copy and paste (including the comma and new line):
+
--
{copypaste}
----
,
'@matrix:* '
----
--
+
. Drag and drop from the left to the editor +
kbd:[string [@key = text\]] -> `editor`
+
{empty} +

IMPORTANT: Your segments should now be defined matching the *preview* shown earlier. +
Verify they match, and make corrections if necessary.
====
+
{empty} +
+
Let's now do 2.
+
--
. On the editor's left panel click the tab: +
 **[    Function    ]**
+
{blank}
+
. Drag and drop the _String_ function *_Concatenate_* from left to right +
kbd:[Concatenate] -> `editor`
+
{blank}
+
[NOTE]
====
After you drop the function, you should see in your blue text area the following result:

++++
<div style="background:#EAFAFA; padding:15px 15px 15px 8px; border-radius:8px; font-family:Consolas,monospace; font-size:14px; line-height:1.6; position:relative;">
  <pre style="margin:0; background:#EAFAFA; padding-left:50px; border:none; outline:none;">
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">1</span><span style="color:#999;"><b style="color:#000;">concat(</b>'*'</span>
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">2</span><span style="color:#999;">, $matrix-x/fn:map/fn:map[@key='fromUser']/fn:string[@key='username'],</span>
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">3</span><span style="color:#999;">'@matrix:* '</span>
<span style="counter-increment:line; position:absolute; left:10px; width:30px; text-align:right; color:#888; user-select:none;">4</span><span style="color:#999;">, $matrix-x/fn:map/fn:string[@key='text']<b style="color:#000;">)</b></span></pre>
</div>
++++
====
+
. The definition is complete, click pass:a[<span {btn-stl-blue}>Close</span>]
--
+
{empty} +
+
When you close the editor you should see the field connections in your mapper as follows:
+
image::images/new/mapper-user-text.jpg[align="left", width=90%]
+
[TIP]
====
If you don't see the data connections above try again as follows: 

. Click the trash button to delete the current expression
. Click the dots to add a new expression
. Copy and paste the expression below:
+
--
{copypaste}
----
concat('*', $matrix-x/fn:map/fn:map[@key='fromUser']/fn:string[@key='username'],'@matrix:* ', $matrix-x/fn:map/fn:string[@key='text'])
----
--
====
+
Your data mapping definition is now complete with multiple input fields mapped to output fields.
+
{empty} +

. Log the body
+
Click the **Design** view to go back to Kaoto's canvas: +
image:images/new/kaoto-views.jpg[align="left", width=40%]
+
Update the log activity from:
+
* `${variable.matrix}` -> to `${body}`
+
NOTE: The Matrix Kamelet is configured to store events in a variable `matrix`, however, the data mapper outputs the result in the `body`.
+
{empty} +

. Run the flow again by issuing the following command:
+
--
{copypaste}
----
labrun m2r \
--properties matrix.properties
----
--
+
[pass]
<details>
  <summary>
    <span class="triangle"></span>
    <span class="sumtext">Click for more information</span>
  </summary>
<p style="margin-top: 1em;">We provide the script <code>labrun</code> to help you read the commands more clearly.</br>
Under the hood the script calls <i>Camel JBang</i> as per the snippet below:
<pre>
camel run \
--source-dir m2r \
--properties matrix.properties \
--local-kamelet-dir ../support/kamelets
</pre></p>
</details>
+
{empty} +


. From Matrix send another chat message and inspect your terminal output.
+
Try one more time:
+
--
{copypaste}
----
Hello Camel
----
--
+
//image::images/gitter-send-message.png[align="left", width=60%]
+
[subs=attributes]
++++
<div class="matrix-flow-wrapper">
  <!-- Scoped Styles for this component -->
  <style>
    .matrix-flow-wrapper {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      background-color: white;
    }

    .platform-row {
      display: flex;
      align-items: flex-start;
      gap: 5px;
    }

    /* Icons */
    .icon-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 60px;
      text-align: center;
      flex-shrink: 0;
    }
    
    .icon-box {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 5px;
      margin-left: 15px;
      z-index: 2;
    }
    
    .icon-label {
      font-size: 18px;
      color: #000;
      font-weight: 500;
      margin-left: 15px;
    }

    .matrix-bg { background-color: #33C69D; }
    
    /* Message Bubbles (Light) */
    .msg-bubble-light {
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fcfcfc;
      width: 260px;
      padding: 0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      position: relative;
      z-index: 2;
    }
  </style>

  <!-- Main Flex Container -->
  <div style="display: flex; align-items: flex-end;">
    
    <!-- Arrow Column -->
    <div style="margin-right: 10px; margin-bottom: 40px;">
      <svg width="120" height="120" viewBox="0 0 130 180" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block;">
        <path d="M20 10H45V80C45 113.137 71.8629 140 105 140H120V120L150 150L120 180V160H105C58.0558 160 20 121.944 20 75V10Z" fill="#EDEDED" stroke="#777" stroke-width="2"/>
      </svg>
    </div>

    <!-- Content Column -->
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <div class="platform-row">
        <!-- Matrix Icon -->
        <div class="icon-container">
          <div class="icon-box matrix-bg" style="margin-top: 5px; transform: scale(1);">
            <svg width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <g transform="translate(-11 -11) scale(0.09)">
                <path stroke-width="30" d="m153.25 277.15c.47-46.35 37.79-81.6 81.6-81.6m0-42.3c46.35.47 81.6 37.79 81.6 81.6m42.3 0c-.47 46.35-37.79 81.6-81.6 81.6m0 42.3c-46.35 0-81.6-37.79-81.6-81.6"/>
              </g>
            </svg>
          </div>
          <span class="icon-label">Matrix</span>
        </div>

        <!-- Matrix Message Box -->
        <div style="border: 1px solid #ddd; border-radius: 4px; background: #fff; width: 260px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; flex-direction: column; padding: 5px 5px; gap: 2px; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
          <div style="display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background-color: #4a90e2; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; flex-shrink: 0;">
              U
            </div>
            <div style="margin-left: 12px; font-weight: bold; font-size: 15px; color: #00d781; line-height: 1;">
              {user-username}
            </div>
          </div>
          <div style="background-color: #eee; display: flex; align-items: baseline; padding: 5px 0px;">
            <div style="width: 30px; text-align: center; font-size: 10px; color: #6c757d; flex-shrink: 0;">
              22:10
            </div>
            <div style="margin-left: 12px; font-size: 15px; color: #333; line-height: .5;">
              Hello Camel
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
++++
+
{blank}
+
You should see an incoming event now transformed and looking similar to this:
+
--
{snippet}{user-username}
[subs="attributes+"]
----
{"channel":"REPLACE","text":"*{user-username}@matrix:* Hello Camel"}
----
--
+
{empty} +

Hopefully your test worked. +
Your next task will be to complete the process by connecting the flow to _Rocket.Chat_.

{empty} +



[type=verification]
Did you see the message successfully transformed into Rocket.Chat format?


[time=5]
[id="connect-backend"]
== Connect the backend 
{style-all}

You're almost there. +

Your last task on this chapter will be to integrate _Rocket.Chat_ in the process so that messages can flow end-to-end, from _Matrix_ to _Rocket.Chat_.

{empty} +

[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****


. [[step-rocketchat-sink]]Include the Rocket.Chat Kamelet.
+
As last step in the flow, include the _Rocket.Chat Kamelet_ following the instructions. 
+
Click the {cp-btn} button to copy the snippet to the clipboard, and continue below.
+
--
{copypaste}
----
{
  "type": "Route",
  "name": "to",
  "definition": {
    "uri": "kamelet",
    "description": "RocketChat",
    "parameters": {
      "templateId": "rocketchat-sink",
      "userid": "{{rocketchat.userid}}",
      "token": "{{rocketchat.token}}"
    }
  },
  "__kaoto_marker": "kaoto-node"
}
----
--
+
Then perform these actions:
+
--
1. Right-click the *_LOG_* activity (last step of the flow)
1. Click the option: kbd:[{btn-paste} Paste as next step]
+
NOTE: In the next release of Kaoto, copy/paste actions into the canvas will be done in YAML. The current format is still JSON.
--
+
The image below shows you the complete Camel route:
+
image::images/new/route-matrix-to-rc.png[align="left", width=40%]
+
{blank}
+
[pass,subs=attributes]
<details>
  <summary>
    <span class="triangle"></span>
    <span class="sumtext"><b>TIP:</b> You can customise the label under each step. Click for more information</span>
  </summary>
  <div style="border: 2px solid #d0d7de; border-radius: 6px; padding: 0 12px 12px; margin: 1.5em 0;">
<p style="margin-top: 1em;">Follow the steps below to configure each step description.</br>
<ol>
  <li>Click on the step you want to rename.</li>
  <li>Select <i>All</i> in the configuration panel:
<span style="display: inline-flex; border: 1px solid #b3b3b3; border-radius: 5px; overflow: hidden; font-family: 'Segoe UI', sans-serif; font-weight: 550; font-size: 14px; cursor: pointer;margin-top: 5px;margin-left: 20px;">
  <span style="padding: 8px 24px; background-color: #ffffff; color: #1a1a1a;">Required</span>
  <span style="padding: 8px 48px; background-color: #0277D4; color: #ffffff;">All</span>
  <span style="padding: 8px 24px; background-color: #ffffff; color: #1a1a1a;">Modified</span>
</span>
  </li>
  <li>Find and edit the following parameter:
    <span style="display: inline-flex; align-items: center; font-family: 'Segoe UI', sans-serif; font-size: 24px; color: #000;margin-left: 5px;">
    Description
    <svg style="width: 24px; height: 24px; fill: #757575; margin-left: 8px;" viewBox="0 0 24 24">
        <path d="M11 18h2v-2h-2v2zm1-16C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm0-14c-2.21 0-4 1.79-4 4h2c0-1.1.9-2 2-2s2 .9 2 2c0 2-3 1.75-3 5h2c0-2.25 3-2.5 3-5 0-2.21-1.79-4-4-4z"/>
    </svg>
</span>
  </li><br/>
  <li>Repeat these actions for each step you want to rename.</li>
</ol><br/>
This example shows the same process with more meaningful labels:
<img src="{imagesdir}images/new/route-matrix-to-rc-custom.png" style="width: 50%;margin-left: 10px;"/>
</p></div>
</details>
+
{empty} +

. Configure the _Rocket.Chat_ credentials
+
Open in your editor your `rocketchat.properties` file and add the following entries:
+
--
{copypaste}/configuration/rocketchat/{user-username}
----
# Rocket.Chat credentials
rocketchat.token=REPLACE
rocketchat.userid=REPLACE
----
--
+
NOTE: Both parameters have been automatically pre-configured for your use in this lab.
+
{empty} +

. Run the flow again as follows:
+
--
{copypaste}
----
labrun m2r \
--properties matrix.properties,rocketchat.properties
----
--
+
[pass]
<details>
  <summary>
    <span class="triangle"></span>
    <span class="sumtext">Click for more information</span>
  </summary>
<p style="margin-top: 1em;">We provide the script <code>labrun</code> to help you read the commands more clearly.</br>
Under the hood the script calls <i>Camel JBang</i> as per the snippet below:
<pre>
camel run \
--source-dir m2r \
--properties matrix.properties,rocketchat.properties \
--local-kamelet-dir ../support/kamelets
</pre></p>
</details>
+
{empty} +

. One more time, from _Matrix_ send one last message. If all goes well you should see the message listed in your _Rocket.Chat_ chat window
+
--
{copypaste}
----
Hello from Matrix
----
--
+
//image::images/stage1-msg-gitter-slack.png[align="left", width=80%]
+
[subs=attributes]
++++
<div class="matrix-flow-wrapper">
  <!-- Scoped Styles for this component -->
  <style>
    .matrix-flow-wrapper {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      padding: 20px;
      background-color: white;
    }

    .platform-row {
      display: flex;
      align-items: flex-start;
      gap: 5px;
    }

    /* Icons */
    .icon-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 60px;
      text-align: center;
      flex-shrink: 0;
    }
    
    .icon-box {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 5px;
      margin-left: 15px;
      z-index: 2;
    }
    
    .icon-label {
      font-size: 18px;
      color: #000;
      font-weight: 500;
      margin-left: 15px;
    }

    .matrix-bg { background-color: #33C69D; }
    .rocket-bg { background-color: #f5455c; padding: 5px; box-sizing: border-box; }

    /* Message Bubbles (Light) */
    .msg-bubble-light {
      border: 1px solid #ddd;
      border-radius: 4px;
      background: #fcfcfc;
      width: 260px;
      padding: 0;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      position: relative;
      z-index: 2;
    }
  </style>

  <!-- Main Flex Container -->
  <div style="display: flex; align-items: flex-end; margin-: -200px;">
    
    <!-- Arrow Column -->
    <div style="margin-right: -200px; margin-bottom: 35px;">
        

    <!-- Content Column -->
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <div class="platform-row">
        <!-- Matrix Icon -->
        <div class="icon-container">
          <div class="icon-box matrix-bg" style="margin-top: 5px; transform: scale(1);">
            <svg width="45" height="45" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
              <g transform="translate(-11 -11) scale(0.09)">
                <path stroke-width="30" d="m153.25 277.15c.47-46.35 37.79-81.6 81.6-81.6m0-42.3c46.35.47 81.6 37.79 81.6 81.6m42.3 0c-.47 46.35-37.79 81.6-81.6 81.6m0 42.3c-46.35 0-81.6-37.79-81.6-81.6"/>
              </g>
            </svg>
          </div>
          <span class="icon-label">Matrix</span>
        </div>

        <!-- Matrix Message Box -->
        <div style="border: 1px solid #ddd; border-radius: 4px; background: #fff; width: 260px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); display: flex; flex-direction: column; padding: 5px 5px; gap: 2px; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;">
          <div style="display: flex; align-items: center;">
            <div style="width: 30px; height: 30px; background-color: #4a90e2; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 600; font-size: 16px; flex-shrink: 0;">
              U
            </div>
            <div style="margin-left: 12px; font-weight: bold; font-size: 15px; color: #00d781; line-height: 1;">
              {user-username}
            </div>
          </div>
          <div style="background-color: #eee; display: flex; align-items: baseline; padding: 5px 0px;">
            <div style="width: 30px; text-align: center; font-size: 10px; color: #6c757d; flex-shrink: 0;">
              22:21
            </div>
            <div style="margin-left: 12px; font-size: 15px; color: #333; line-height: .5;">
              Hello from Matrix
            </div>
          </div>
        </div>
      </div>
    </div>
    
        <div style="margin-left: 100px; margin-top: -20px" class="platform-row">
      <svg width="120" height="120" viewBox="0 0 130 180" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: block;">
        <path d="M20 10H45V80C45 113.137 71.8629 140 105 140H120V120L150 150L120 180V160H105C58.0558 160 20 121.944 20 75V10Z" fill="#EDEDED" stroke="#777" stroke-width="2"/>
      </svg>

    <!-- Content Column -->
    <div style="display: flex; flex-direction: column; align-items: flex-start;">
      <div class="platform-row" style="margin-top: 75px; margin-left: -60px">
        <div class="icon-container" >
          <div class="icon-box rocket-bg" style="margin-top: -5px; margin-left: 750px" >
            <svg width="45" height="45" viewBox="0 0 24 24" fill="white">
              <g transform="translate(-2 -2) scale(.9)">
              <path d="M 7.5488281 5 C 6.2638281 5 5.055 5.3086094 4 5.8496094 C 5.422467 6.9694938 6.4322525 8.5274703 6.8359375 10.300781 C 5.0652471 11.854193 4 13.838545 4 16 C 4 18.1 5.0028438 20.110797 6.8398438 21.716797 C 6.5498438 22.966797 5.9480312 24.134047 5.0820312 25.123047 L 4.0136719 26.345703 L 5.5859375 26.751953 C 6.2259375 26.917953 6.8868281 27 7.5488281 27 C 9.7768281 27 11.841828 26.197516 13.423828 24.728516 C 14.425828 24.908516 15.458 25 16.5 25 C 23.393 25 29 20.962 29 16 C 29 11.038 23.393 7 16.5 7 C 15.440923 7 14.418235 7.1058017 13.435547 7.2851562 C 11.913547 5.8774278 9.8442485 5 7.5488281 5 z M 16.5 9 C 22.29 9 27 12.14 27 16 C 27 19.86 22.29 23 16.5 23 C 15.412 23 14.338594 22.888969 13.308594 22.667969 L 12.757812 22.548828 L 12.371094 22.957031 C 11.147094 24.252031 9.469625 24.976 7.640625 25 C 8.290625 23.917 8.727875 22.724516 8.921875 21.478516 L 9.0136719 20.896484 L 8.5488281 20.535156 C 6.9058281 19.256156 6 17.646 6 16 C 6 12.14 10.71 9 16.5 9 z M 11.5 15 A 1.5 1.5 0 0 0 11.5 18 A 1.5 1.5 0 0 0 11.5 15 z M 16.5 15 A 1.5 1.5 0 0 0 16.5 18 A 1.5 1.5 0 0 0 16.5 15 z M 21.5 15 A 1.5 1.5 0 0 0 21.5 18 A 1.5 1.5 0 0 0 21.5 15 z"/>
            </svg>
          </div>
          <span class="icon-label" style="margin-left: 750px">rocket.chat</span>
        </div>
        <div style="border: 1px solid #ddd; border-radius: 4px; background: #fff; width: 320px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); position: relative; display: flex; flex-direction: row; align-items: flex-start; padding: 8px 10px; gap: 10px; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;background-color: #F2F3F5">    
          <div style="width: 32px; height: 32px; background-color: #6c757d; color: white; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 16px; flex-shrink: 0;">
            U
          </div>
          <div style="display: flex; flex-direction: column; justify-content: center; ">
            <div style="display: flex; align-items: baseline; gap: 8px; margin-bottom: 2px; line-height: 1.2;">
              <span style="font-weight: bold; font-size: 14px; color: #333;">{user-username}</span>
              <span style="font-size: 11px; color: #aaa;">10:21 PM</span>
            </div>
            <div style="font-size: 14px; color: #333; line-height: 1; margin: 0; padding: 0;">
              <strong>{user-username}@matrix: </strong>Hello from Matrix
            </div>
          </div>
        </div>
      </div>
    </div>
      </div>
    </div>
  </div>
</div>
++++
+
//{empty} +
+
Hopefully you'll see a successful interaction between both chat systems, similar to the image above.
+
Press kbd:[Ctrl+C] to stop your Camel instance.
+
'''

{empty} +

If all went well, you can consider the local development for this first flow done.

However, this flow only moves messages in one direction. Your next goal will be to enable a bi-directional data flow between the two systems, but it won‚Äôt be as straightforward as you might think.

To find out, finish this lab with the next documentation exercise and move to the next chapter.

{empty} +

[type=verification]
Did you see the message in _Matrix_ showing up in _Rocket.Chat_?

[type=verificationSuccess]
Finish this chapter by completing the next task.

[type=verificationFail]
Review your steps in the exercise and try again.





[time=5]
[id="documentation"]
== Generate flow documentation 
{style-all}

Your final task in this chapter is to generate documentation for the _Matrix_ -> _Rocket.Chat_ integration you have built.

TIP: Running short on time? A quick read of the instructions below is enough to move on.

In real-world organizations, maintaining accurate and up-to-date documentation for application integrations is essential. When done manually, this process is time-consuming, error-prone, and documentation quickly becomes outdated or incomplete.

Kaoto can automatically generate clean, Markdown-formatted documentation that describes your Camel integration routes. Follow the steps below to create this documentation for your project.

{empty} +

=== Generate and download

. Click the button kbd:[{btn-download}] located in the top button bar in Kaoto. +
The action will open a window where you can see a preview of the generated documentation.
+
{empty} +

. Click pass:a[<span {btn-stl-blue}>{ico-download} &nbsp; Download</span>] to obtain a local backup. +
It will package and download (ZIP) the documation to your machine.
+
-> Save the ZIP file in your local drive, for example under `Downloads`.
+
{empty} +


=== Open and visualise the documentation

{blank}

. Create a directory where to upload the ZIP file
+
--
{copypaste}
----
mkdir docs
----
--
+
{empty} +


. From the left panel (file explorer), right-click the new folder you created: +
pass:[<div style="padding-left: 0rem;"><code style="background-color: black; color: lightgrey"> workshop ‚ùØ lab ‚ùØ docs </code></div>] +
Then choose the option pass:[<code style="background-color: #0277D4; color: white;">&nbsp;Upload...&nbsp;</code>], locate and select the ZIP file `route-export.zip` you previously saved, and complete the action to upload.
+
{empty} +

. Unzip and delete the package with:
+
--
{copypaste}
----
unzip docs/route-export.zip -d docs
rm docs/route-export.zip
----
--
+
{empty} +

. Right-click the _Markdown_ document: +
pass:[<div style="padding-left: 0rem;"><code style="background-color: black; color: lightgrey"> workshop ‚ùØ lab ‚ùØ docs ‚ùØ <span style="color: white;"><b>route-export.md</b></span> </code></div>] +
Then choose the option pass:[<code style="background-color: #0277D4; color: white;">&nbsp;Open Preview&nbsp;</code>]
+
{empty} +
+
The _Markdown_ document will open as shown below:
+
image::images/new/kaoto-route-docs.png[align="left", width=60%]
+
[NOTE]
--
Above you see:

* A visual diagram rendering the Camel route
* Details about each one of the steps in the process.
--

{empty} +

[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****
