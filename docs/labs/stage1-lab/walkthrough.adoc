:walkthrough: Matrix to Rocket.Chat bridge ()
:user-password: openshift
:namespace: {user-username}-devspaces
:invite-url: http://invite-webapp.{openshift-app-host}

:url-element: https://element-matrix.{openshift-app-host}
:url-rocketchat: https://rocketchat-rocketchat.{openshift-app-host}
:url-codeready: http://devspaces.{openshift-app-host}/
:url-devconsole: {openshift-host}/topology/ns/{namespace}

:experimental:

// WORKS
:style-kbd: kbd { \
  color: black; \
  background-color: lightgrey; \
  border: 1px solid black; \
  box-shadow: 0px 1px black; \
  font-size: .85em; \
  line-height: .85em; \
  display: inline-block; \
  font-weight: 600; \
  letter-spacing: .05em; \
  padding: 3px 5px; \
  white-space: nowrap; \
  border-radius:5px; \
} \

:style-summary: summary {cursor: pointer; list-style: none;}
:style-triangle: .triangle {margin-right: .5em;} summary:hover .sumtext {text-decoration: underline;}
:style-details:  .triangle::before {content: "‚ñ∂";} details[open] .triangle::before {content: "‚ñº";}
:style-open-close: {style-summary}{style-triangle}{style-details} 

:style-preview: pre {background-color: #272822; color: white; padding: 5px 15px; font-size: 15px}
:style-indent: .indent2 {padding-left: 2rem;}
:style-all: pass:a[<style>{style-kbd}{style-preview}{style-indent}{style-open-close}</style>]


:url-docserver: https://docserver-webapp.{openshift-app-host}
//:url-docserver: https://docserver-webapp.apps.cluster-mqpjp.dynamic.redhatworkshops.io/
//:url-docserver: http://0.0.0.0:8080

:docserver-status: pass:a[<img hidden="true" src="invalid-image.jpg" onerror=" \
        fetch('{url-docserver}/status') \
        .then(response => response.text()) \
        .then(data => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:lime;display:inline-block&quot;></div>') \
        .catch(error => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:red;display:inline-block&quot;></div>') \
      ">]

:freplace: pass:[function replaceTokens(templateString, values) { \
    const valueArray = values.split(',').map(val => val.trim()); \
    let result = templateString; \
    let replaceIndex = 0; \
    while (result.includes('REPLACE') && replaceIndex < valueArray.length) { \
        result = result.replace('REPLACE', valueArray[replaceIndex]); \
        replaceIndex++; \
    } \
    return result; \
}]

//:fdocserver: pass:a[function docserver(target,template,params) { \
//    {freplace} \
//    fetch('{url-docserver}/roomid?user='+params) \
//        .then(response => response.text()) \
//        .then(data => {target.firstChild.data=replaceTokens(text, data);}) \
//        .catch(error => room = 'Error fetching data: ' + error.message); \
//}]

:fdocserver: pass:a[function docserver(target,template,params) { \
    {freplace} \
    fetch('{url-docserver}'+params.trim()) \
        .then(response => response.text()) \
        .then(data => {target.firstChild.data=replaceTokens(text, data);}) \
        .catch(error => room = 'Error fetching data: ' + error.message); \
}]

:fcopy: pass:a[function copy(el) { \
  el.previousElementSibling.select(); \
  text = el.previousElementSibling.textContent; \
  console.log(text); \
  navigator.clipboard.writeText(text + '\n') \
        .then(response => console.log('Text with carriage return copied to clipboard!')) \
        .catch(err => console.error('Failed to copy: ', err)); \
}]

:copypaste: pass:a[ \
<div style="border: 1px solid #f0f0f0; border-bottom-color: #8a8d90; display: flex; align-items: flex-start;"> \
  <textarea readonly style="field-sizing: content;border: none; background-color: #f0f0f0; width: 100%; resize: none; font-size:14px; font-family: monospace;padding: 5px 15px" rows="4">function example() { \
  console.log("Hello {replace-with-previous}!"); \
  return true; \
}</textarea> \
  <button class="mytooltip" onclick="{fcopy} copy(this);" style="border: none; background-color: white; padding: 5px 15px; border-bottom: 1px solid transparent; transition: border-bottom-color 0.2s;"> \
    <svg fill="currentColor" height="1em" width="1em" viewBox="0 0 448 512" aria-hidden="true" role="img" style="vertical-align: -0.125em;"> \
      <path d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"></path> \
    </svg> \
    <span class="mytooltiptext">Copy to clipboard</span> \
  </button> \
  <style> \
.mytooltip{position:relative;display:inline-block;border-bottom:1px dotted black}.mytooltip .mytooltiptext{visibility:hidden;width:120px;background-color:#555;color:#fff;text-align:center;border-radius:6px;padding:5px 0;position:absolute;z-index:1;bottom:125%;left:50%;margin-left:-60px;opacity:0;transition:opacity 0.3s}.mytooltip .mytooltiptext::after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#555 transparent transparent transparent}.mytooltip:hover .mytooltiptext{visibility:visible;opacity:1} \
  </style> \
</div> \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  {fdocserver} \
  let txtarea = this.parentElement.querySelector('textarea'); \
  let div = this.closest('.paragraph'); \
  if(!div.closest('.openblock')){div = div.parentElement} \
  let source = div.nextElementSibling; \
  let pre = source.querySelector('pre'); \
  let text = pre.textContent; \
  let lineCount = text.split('\n').length; \
  let tokens = this.nextSibling; \
  console.log('tokens: [' +tokens.data.trim()+']'); \
  if(tokens.data.trim()!=''){docserver(txtarea,text,tokens.data);} else {txtarea.firstChild.data=text;} \
  source.remove(); \
  tokens.remove(); \
  this.remove(); \
}"> \
]

:snippet: pass:a[ \
<div style="border: 1px solid #f0f0f0; border-bottom-color: #8a8d90; display: flex; align-items: flex-start;"> \
</div> \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  {freplace} \
  let block = this.closest('.openblock'); \
  let div = this.closest('.paragraph'); \
  let source = div.nextElementSibling; \
  let pre = source.querySelector('pre'); \
  let text = pre.textContent; \
  let lineCount = text.split('\n').length; \
  let tokens = this.nextSibling; \
  tokens.data = tokens.data.replace('user','room'); \
  console.log('tokens: [' +tokens.data.trim()+']'); \
  console.log('before text: [' +text+']'); \
  text = replaceTokens(text, tokens.data.trim()); \
  pre.textContent = text; \
  console.log('after text: [' +text+']'); \
  console.log(block); \
  block.parentElement.insertBefore(pre,block); \
  block.remove(); \
}"> \
]


:room: pass:a[ \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  let code = this.previousElementSibling; \
  let text = code.textContent; \
  console.log('before text: [' +text+']'); \
  text = text.replace('user', 'room'); \
  code.textContent = text; \
  console.log('after text: [' +text+']'); \
  this.remove(); \
}"> \
]

ifdef::env-github[]
endif::[]

[id='lab1-camel']
= Lab 1 - (b) - Be the Camel developer

Impersonate the Camel developer to complete Lab-1's Matrix to Rocket.Chat processing flow.


[type=walkthroughResource,serviceName=openshift]
.Invite System
****
[subs=attributes]
++++
<div style="padding-left: 20px">{docserver-status}<div>
++++
****


Prerequisites: +
--
* Ensure you have previously completed the following tiles:
+
image::images/prereq.png[align="left", width=100%]

{empty} +
--

Technical goals and milestones:

* Development of a _no-code_ integration (_Kamelet_ binding)
* Define JSON data transformers.
* Use of _Camel JBang_ for fast prototyping
* Local execution and testing
* Deployment in OpenShift

{empty} +

The instructions below are divided in two segments:

* Local development (and testing)
* Deployment in OpenShift

{empty} +

[time=10]
[id="local"]
== Local development 
{style-all}

[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****

For reference, here's again the processing flow to implement:

image::images/new/processing-flow.jpg[align="center", width=80%]

The Camel route will include 3 processing steps:

====
* *A source _Kamelet_* +
Consumes events from _Matrix_.

* *A data mapping* +
Transforms _Matrix_ events to _Rocket.Chat_ events (in JSON format).

* *A sink _Kamelet_* +
Produces events to _Rocket.Chat_.
====

{empty} +

[IMPORTANT] 
--
You need to already be onboarded into _Matrix_ and _Rocket.Chat_. +
Ensure you have previously completed: 

- *_Lab 1.intro - MessageHub - Scenario and Onboarding_*.
--

{empty} +

The development tool that will help us iterate our code in our local environment is _Camel JBang_.

image::images/camel-jbang.png[align="left", width=40%]

{empty} +

TIP: Camel JBang is an upstream tool for _Camel_. It is not supported yet by Red Hat but it is an extremely useful tool for all things Camel. It simplifies many of the common tasks a Camel developer undergoes. 

=== Start the lab

At first, your `lab` directory is empty:

--
[.indent2]
üìÅ message-hub +
&nbsp;&nbsp;üìÅ *lab* +
pass:[<mark style="padding-left: 1rem; background-color: white; color: grey"></mark>] [empty]
--

{blank}

IMPORTANT: All the commands you'll be asked to run all along the workshop are designed to be executed from your root `lab` folder. +
Stay always on your `lab` folder, there's no need to change directories.

{empty} +

From your UI terminal...

image::images/crw-terminal.png[align="left", width=100%]

{blank}

We provide below a base skeleton to get you started:

[IMPORTANT]
====
Issue the command below to officially start your lab:

--
{copypaste}
----
start
----
--

NOTE: The command will initialise the lab with a couple of files.
====


// {empty} +

[NOTE]
====
The lab has a collection of handy scripts you'll need to use when instructed, such as:

- *start* / *restart*
- *ff* (fast-forward to the next step)
- *rw* (rewind to the previous step)
- *step* (jump to step)
- *chat* (curl-based script to interact with _Camel_)
====

{empty} +

=== Your files

After initialisation, under the `lab` directory, you'll find the following source files:


--
[.indent2]
üìÅ message-hub +
&nbsp;&nbsp;üìÅ lab +
&nbsp;&nbsp;&nbsp;&nbsp;üìÅ m2r +
pass:[<mark style="padding-left: 2rem; background-color: white; color: purple"><b><i>&nbsp;!&nbsp;&nbsp;</i></b></mark>] *m2r.camel.yaml* +
pass:[<mark style="padding-left: 1rem; background-color: white; color: grey"><b>‚öô</b></mark>] matrix.properties +
pass:[<mark style="padding-left: 1rem; background-color: white; color: grey"><b>‚öô</b></mark>] rocketchat.properties +
--

{blank}

Make sure the files are visible in your file explorer in the left panel of _VSCode_. +
Feel free to inspect the files in your editor. +

{empty} +

. Under your `lab/m2r` directory, find and open the following flow definition:
+
--
* `m2r.camel.yaml`
--
+
{blank}
+
PENDING to include IMAGE of Kaoto flow]
+
[NOTE]
--
About the `matrix-source` _Kamelet_:

* It's not provided out of the box by Camel. It has been specifically created and deployed for this workshop.
* It's implemented following the specification of the Matrix Sync API (new Matrix's API) to consume events from the server. To know more, read its API documentation here: https://spec.matrix.org/v1.6/client-server-api/#syncing
--
+
[NOTE]
--
About the variable `matrix`:

* The Kamelet defines `variableReceive: matrix` to allocate the incoming event (`body` is ignored).
* The route logs the incoming event using the Camel's simple expression `${variable.matrix}`
--
+
{empty} +

. Configure the _Matrix_ credentials
+
Open in your editor your `matrix.properties` file and add the following entries:
+
--
{copypaste}/configuration/matrix/{user-username}
----
# Matrix credentials
matrix.token=REPLACE
matrix.room=REPLACE
----
--
+
NOTE: both parameters have been automatically pre-configured for your use in this lab.
+
{empty} +


. Run your YAML definition with Camel JBang
+ 
Use the following command to run locally your _Camel_ route:
+
--
{copypaste}
----
camel run \
--source-dir m2r \
--properties matrix.properties \
--local-kamelet-dir ../support/deploy/kamelets
----
--
+
NOTE: The command above includes flags to tell _Camel JBang_ where to find the resources needed (code, properties, _Kamelets_).
+
{blank}
+
_Camel JBang_ will build a local runnable and start it. +
In your terminal logs, you should see _Camel_ connecting to _Matrix_, similar to the following:
+
++++
<pre style="line-height: 1;white-space: pre-wrap"><span style="color:grey;font-family: monospace;font-size: 12px;">2025-10-30 21:59:34.277 <span style="color: limegreen">INFO</span> <span style="color: deeppink">4330</span> --- [           main] <span style="color: cyan;">.impl.engine.AbstractCamelContext</span><span style="color: white;"> : Apache Camel 4.15.0 (m2r) started in 800ms (build:0ms ...)</span>
2025-10-30 21:59:35.176 <span style="color: limegreen;">INFO</span> <span style="color: deeppink">4330</span> --- [atrix-streaming] <span style="color: cyan">matrix-source.kamelet.yaml:58</span><span style="color: white;">     : Opening connection to Matrix...</span>
2025-10-30 21:59:35.390 <span style="color: limegreen;">INFO</span> <span style="color: deeppink">4330</span> --- [atrix-streaming] <span style="color: cyan">matrix-source.kamelet.yaml:67</span><span style="color: white;">     : Matrix HTTP Streaming started</span>
</span></pre>
++++
+
{empty} +
+
Now, from the _Matrix_ chat room, send a message.
+
* For example:
+
--
{copypaste}
----
Hello Camel
----
--
+
image::images/gitter-send-message.png[align="left", width=60%]
+
{blank}
+
Your terminal should show the arrival of a _Matrix_ event similar to the following JSON payload:
+
[subs="attributes+"]
++++
<pre style="line-height: 1;white-space: pre-wrap"><span style="color:grey;font-family: monospace;font-size: 12px;">2025-10-30 21:59:55.672 <span style="color: limegreen;">INFO</span> <span style="color: deeppink">4330</span> --- [ad #7 - WireTap] <span style="color: cyan">m2r.camel.yaml:12</span><span style="color: white;">     : {"fromUser":{"username":"{user-username}","displayName":"{user-username}"},"text":"<span style="background-color: #ffff00; color: #000000; padding: 0px 0px;">Hello Camel</span>","sent":"2025-10-30T21:59:55.000Z"}</span>
</span></pre>
++++
+
NOTE: Find the message content highlighted in yellow.
+
{blank}
+
Hopefully you've been successful in capturing _Matrix_ messages with _Camel_.
+
Press kbd:[Ctrl+C], from your terminal, to stop the running _Camel_ process.
+
[TIP]
--
_Camel JBang_ also implements the following very handy commands when running multiple _Camel_ integrations:

* `camel ps` to list running _Camel_ integrations.
* `camel stop <instance_name>` to shut down a running _Camel_ integration.  
--
+
{empty} +


. Include data transformation
+
Now we need to extend the _Camel_ route definition to include data transformation to match the JSON structure the target system (_Rocket.Chat_) expects.
+
.. Include in your Camel route a Kaoto data transformation step
+
--
From Kaoto: 

. Click the `+` button in the transition
. Find and select the _Kaoto DataMapper_
. Click to open the configuration panel
. Click the `üîßConfigure` button
--
+
{blank}
+
.. Attach schemas
+
--
From the DataMapper editor: 

. Define the source:
.. On `Parameters` click the `+` to add new parameter
.. Enter `matrix` and click the checkmark button kbd:[‚àö]
.. Click first the Attach schema button, then the blue button, and pick `matrix-in.json`.
+
{blank}
+
. Define the target
.. Find the target Body and click on "Attach schema", then the blue button, and pick `rocketchat-out.json`

{blank}
--
+
{blank}
+
.. Define the data mappings
+
Copy and Paste the values below to define the given field entries:
+
... `string[@key = channel]`: 
+
--
{copypaste}/roomid/{user-username}
----
"REPLACE"
----
--
+
{blank}
+
... `string[@key = text]`:
+
--
{copypaste}
----
concat('*', $matrix-x/xf:map/xf:map[@key='fromUser']/xf:string[@key='username'],'@matrix:* ', $matrix-x/xf:map/xf:string[@key='text'])
----
--
+
NOTE: The field `text` concatenates various fields from the input _Matrix_ event.
+
{empty} +

. Log the body
+
Update the log activity from:
+
* `${variable.matrix}` -> to `${body}`
+
NOTE: The Matrix Kamelet is configured to store events in a variable `matrix`, however, the data mapper outputs the result in the `body`.
+
{empty} +

. Run the flow again by issuing the following command:
+
--
{copypaste}
----
labrun m2r \
--properties matrix.properties
----
--
+
[pass]
<details>
  <summary>
    <span class="triangle"></span>
    <span class="sumtext">Click for more information</span>
  </summary>
<p style="margin-top: 1em;">We provide the script <code>labrun</code> to help you read the commands more clearly.</br>
Under the hood the script calls <i>Camel JBang</i> as per the snippet below:
<pre>
camel run \
--source-dir m2r \
--properties matrix.properties \
--local-kamelet-dir ../support/deploy/kamelets
</pre></p>
</details>
+
{empty} +

. From Matrix send another chat message and inspect your terminal output. +
You should see an incoming event now transformed and looking similar to this:
+
--
{snippet}{user-username}
[subs="attributes+"]
----
{"channel":"REPLACE","text":"*{user-username}@matrix*: Hello Camel"}
----
--
+
At this stage you're ready to forward messages to _RocketChat_ using its dedicated _Kamelet_.
+
{empty} +


. [[step-rocketchat-sink]]Include the Rocket.Chat Kamelet.
+
Copy from below the step definition, and paste it at the end of your Camel route.
+
TIP: Right-click over the _Log_ step and select  `üìã Paste as next step`.
+
--
{copypaste}
----
{
  "type": "Route",
  "name": "to",
  "definition": {
    "uri": "kamelet",
    "description": "RocketChat",
    "parameters": {
      "templateId": "rocketchat-sink",
      "userid": "{{rocketchat.userid}}",
      "token": "{{rocketchat.token}}"
    }
  },
  "__kaoto_marker": "kaoto-node"
}
----
--
+
NOTE: In the next release of Kaoto, copy/paste actions into the canvas will be done in YAML. The current format is still JSON.
+
{empty} +


. Configure the _Rocket.Chat_ credentials
+
Open in your editor your `rocketchat.properties` file and add the following entries:
+
--
{copypaste}/configuration/rocketchat/{user-username}
----
# Rocket.Chat credentials
rocketchat.token=REPLACE
rocketchat.userid=REPLACE
----
--
+
NOTE: Both parameters have been automatically pre-configured for your use in this lab.
+
{empty} +

. Run the flow again as follows:
+
--
{copypaste}
----
labrun m2r \
--properties matrix.properties,rocketchat.properties
----
--
+
[pass]
<details>
  <summary>
    <span class="triangle"></span>
    <span class="sumtext">Click for more information</span>
  </summary>
<p style="margin-top: 1em;">We provide the script <code>labrun</code> to help you read the commands more clearly.</br>
Under the hood the script calls <i>Camel JBang</i> as per the snippet below:
<pre>
camel run \
--source-dir m2r \
--properties matrix.properties,rocketchat.properties \
--local-kamelet-dir ../support/deploy/kamelets
</pre></p>
</details>
+
{empty} +

. One more time, from _Matrix_ send one last message. If all goes well you should see the message listed in your _Rocket.Chat_ chat window
+
--
{copypaste}
----
Hello from Matrix
----
--
+
image::images/stage1-msg-gitter-slack.png[align="left", width=80%]
+
{empty} +
+
Hopefully you'll see a successful interaction between both chat systems, similar to the image above.
+
Press kbd:[Ctrl+C] to stop your Camel instance.
+
{empty} +
+
We can consider the local development done. We have a full data flow definition that routes messages from _Matrix_ to _Rocket.Chat_. The next step is to deploy the definition in _OpenShift_

{empty} +

[type=verification]
Did you see the message in _Matrix_ showing up in _Rocket.Chat_?

[time=5]
[id="openshift"]
== Deployment in OpenShift
{style-all}

[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****

Up until now you've only worked locally (in your dev UI and terminal). This phase has allowed you to prototype fast and produce code you feel confident with.

As per the diagram below, the _Camel_ developer can work at accelerated speed by editing sources and running locally.

image::images/workflow-camel-user.png[align="center", width=80%]

{empty} +

Now that you have validated your code locally, you can proceed to deploy and run in _OpenShift_.

The definitions that you have implemented can be taken as-is into _OpenShift_. +

NOTE: We have configured _Camel JBang_ to include its _Kubernetes_ plugin that allows users to easily deploy into _OpenShift_. +
Below you'll see how it's used.


{empty} +

. To start with, make sure you have stopped you local Camel instance. +
If it is still running, press kbd:[Ctrl+C] to stop it.
+
{empty} +

. Deploy your _Matrix_ to _RocketChat_ integration
+
{blank}
+
.. Use the _Kubernetes_ plugin to deploy your application, as shown below:
+
--
{copypaste}
----
camel kubernetes run m2r/* \
matrix.properties rocketchat.properties \
--name m2r \
--property quarkus.config.locations=rocketchat.properties,matrix.properties \
--local-kamelet-dir ../support/deploy/kamelets \
--cluster-type openshift
----
--
+
NOTE: Deployment actions like the one above will be integrated in future releases _Kaoto_.
+
NOTE: Be patient, this action may take some time to complete (could take up to 10mn the first time).
+
{empty} +
+
.. You can monitor the state of the resource with the following command:
+
--
{copypaste}
----
oc get deployment/m2r
----
--
+
When the deployment is ready, the command outputs something similar to:
+
----
NAME   READY   UP-TO-DATE   AVAILABLE   AGE
m2r    1/1     1            1           10m 
----
+
{empty} +

.. Check the logs from your terminal.
+
You can use different commands to inspect the logs of your deployed `m2r` integration:
+
====
* Using the Camel CLI
+
--
{copypaste}
----
camel kubernetes logs m2r
----
--
+
* Or, using OpenShift's CLI
+
--
{copypaste}
----
oc logs deployment/m2r -f
----
--
====
+
{blank}
+
After a while, when the operator deploys the integration, you should see Camel connecting to Matrix and starting the streaming listener:
+
----
... : Apache Camel 4.14.0 (m2r) started in 323ms (build:0ms init:0ms start:323ms boot:2s201ms)
...
... : Opening connection to Matrix...
... : Matrix HTTP Streaming started
----
+
{empty} +


.. Check your deployment from the _Developer_ console
+
Inspect in your link:{openshift-host}/topology/ns/{namespace}[OpenShift Developer view, window="_blank"] your pod is in healthy state and running:
+
image::images/ocp-dev-pod-healthy.png[align="left", width=80%]
+
{blank}
+
TIP: You can zoom in/out the canvas by using your mouse scrolling function, and move it around by clicking and dragging the background.
+
NOTE: You will observe your project also includes a pre-deployed _Kafka_ cluster. +
Later in the workshop, you will use this dedicated _Kafka_ cluster to stream data in and out.
+
{empty} +

.. Check the logs.
+
You can open the logs of the _Camel_ instance by:
+
--
. Clicking in the pod's icon
. From the right pane, click `Resources`
. Click `View logs`
--
+
{blank}
+
image::images/ocp-dev-pod-logs.png[align="left", width=90%]
+
{blank}
+
You should see _Camel_ connecting to _Matrix_ and indicating the stream has started:
+
----
... : Apache Camel 3.14.2.redhat-00047 (camel-1) started in 825ms (build:0ms init:708ms start:117ms)
...
... : Opening connection to Matrix...
... : Matrix HTTP Streaming started
----
+
{empty} +


. Test your deployment
+
One more time, from Matrix send one last message. If all goes well you should see the message listed in your Rocket.Chat chat window
+
image::images/stage1-msg-gitter-slack.png[align="left", width=80%]
+
{empty} +



[type=verification]
Did you see the message going from _Matrix_ to _Rocket.Chat_?

[type=verificationSuccess]
Great! Jump to the next section to clean your namespace.

[type=verificationFail]
Inspect in the pod logs to investigate possible failure causes.





[time=2]
[id="clean"]
== Undeploy from OpenShift
{style-all}

[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
//* *password:* `{user-password}`
****
[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{url-codeready}[Console, window="_blank"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{url-devconsole}[Topology View, window="_blank"]
****
[type=taskResource]
.Matrix
****
* link:{url-element}[Matrix Web Client, window="_blank"]
****
[type=taskResource]
.Rocket.Chat
****
* link:{url-rocketchat}[Rocket.Chat Web Client, window="_blank"]
****

You're almost done on this lab episode.
In preparation for your next lab exercise, this last section helps you clean your _OpenShift_ project and, more importantly, shows you how to use _Camel JBang_ when it comes to undeploy integrations.

{empty} +

. Undeploy your _"Matrix to RocketChat"_ integration
+
The _Kubernetes_ plugin in _Camel JBang_ makes it super simple to undeploy _Camel_. +
Issue the command below to undeploy `m2r`:
+
--
{copypaste}
----
camel kubernetes delete --name m2r
----
--
+
You'll see the following command output in your terminal:
+
[subs=attributes]
----
Deleting resources in namespace '{user-username}-devspaces' with name: m2r
Deleted: apps/Deployment 'm2r'
Deleted: v1/Service 'm2r'
Deleted: build.openshift.io/BuildConfig 'm2r-s2i'
Deleted: image.openshift.io/ImageStream 'm2r'
Deleted: route.openshift.io/Route 'm2r'
----
+
NOTE: The process is thorough when cleaning the deployment by removing all the artifacts originally created.
+
{empty} +



{empty} +

[type=verification]
Do you see your _Camel_ applications absent in your _OpenShift_ project?

[type=verificationSuccess]
You have now completed Stage 1 !!

[type=verificationFail]
Inspect in the pod logs to troubleshoot.
