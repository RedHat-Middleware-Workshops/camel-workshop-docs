:walkthrough: Lab Introduction
:user-password: openshift
:namespace: {user-username}-devspaces

// URLs
:codeready-url: http://devspaces.{openshift-app-host}/

//:url-docserver: https://docserver-webapp.{openshift-app-host}
//:url-docserver: http://0.0.0.0:8080


//:docserver-status: pass:a[<img hidden="true" src="invalid-image.jpg" onerror=" \
//        fetch('{url-docserver}/status') \
//        .then(response => response.text()) \
//        .then(data => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:lime;display:inline-block&quot;></div>') \
//        .catch(error => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:red;display:inline-block&quot;></div>') \
//      ">]


:experimental:

// WORKS
:style-kbd: kbd { \
  color: black; \
  background-color: lightgrey; \
  border: 1px solid black; \
  box-shadow: 0px 1px black; \
  font-size: .85em; \
  line-height: .85em; \
  display: inline-block; \
  font-weight: 600; \
  letter-spacing: .05em; \
  padding: 3px 5px; \
  white-space: nowrap; \
  border-radius:5px; \
} \

:style-summary: summary {cursor: pointer; list-style: none;}
:style-triangle: .triangle {margin-right: .5em;} summary:hover .sumtext {text-decoration: underline;}
:style-details:  .triangle::before {content: "▶";} details[open] .triangle::before {content: "▼";}
:style-open-close: {style-summary}{style-triangle}{style-details} 



//:style-summary: summary {cursor: pointer; list-style: none;}
//:style-triangle: .triangle::before {content: "▶"; margin-right: .5em;}
//:style-details: details[open] .triangle::before {content: "▼";} details[open] p {margin-top: 1em;}
//:style-open-close: {style-summary}{style-triangle}{style-details} 

:style-preview: pre {background-color: #272822; color: white; padding: 5px 15px; font-size: 15px}
:style-indent: .indent2 {padding-left: 2rem;}
:style-all: pass:a[<style>{style-kbd}{style-preview}{style-indent}{style-open-close}</style>]

:url-docserver: https://docserver-webapp.{openshift-app-host}
//:url-docserver: http://0.0.0.0:8080

:docserver-status: pass:a[<img hidden="true" src="invalid-image.jpg" onerror=" \
        fetch('{url-docserver}/status') \
        .then(response => response.text()) \
        .then(data => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:lime;display:inline-block&quot;></div>') \
        .catch(error => this.parentElement.innerHTML = 'Status: <div style=&quot;width:15px;height:15px;border-radius:50%;background:red;display:inline-block&quot;></div>') \
      ">]

:freplace: pass:[function replaceTokens(templateString, values) { \
    const valueArray = values.split(',').map(val => val.trim()); \
    let result = templateString; \
    let replaceIndex = 0; \
    while (result.includes('REPLACE') && replaceIndex < valueArray.length) { \
        result = result.replace('REPLACE', valueArray[replaceIndex]); \
        replaceIndex++; \
    } \
    return result; \
}]

:fdocserver: pass:a[function docserver(target,template,params) { \
    {freplace} \
    fetch('{url-docserver}/roomid?user='+params) \
        .then(response => response.text()) \
        .then(data => {target.firstChild.data=replaceTokens(text, data);}) \
        .catch(error => room = 'Error fetching data: ' + error.message); \
}]

:fcopy: pass:a[function copy(el) { \
  el.previousElementSibling.select(); \
  text = el.previousElementSibling.textContent; \
  console.log(text); \
  navigator.clipboard.writeText(text + '\n') \
        .then(response => console.log('Text with carriage return copied to clipboard!')) \
        .catch(err => console.error('Failed to copy: ', err)); \
}]

:copypaste: pass:a[ \
<div style="border: 1px solid #f0f0f0; border-bottom-color: #8a8d90; display: flex; align-items: flex-start;"> \
  <textarea readonly style="field-sizing: content;border: none; background-color: #f0f0f0; width: 100%; resize: none; font-size:14px; font-family: monospace;padding: 5px 15px" rows="4">function example() { \
  console.log("Hello {replace-with-previous}!"); \
  return true; \
}</textarea> \
  <button class="mytooltip" onclick="{fcopy} copy(this);" style="border: none; background-color: white; padding: 5px 15px; border-bottom: 1px solid transparent; transition: border-bottom-color 0.2s;"> \
    <svg fill="currentColor" height="1em" width="1em" viewBox="0 0 448 512" aria-hidden="true" role="img" style="vertical-align: -0.125em;"> \
      <path d="M320 448v40c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V120c0-13.255 10.745-24 24-24h72v296c0 30.879 25.121 56 56 56h168zm0-344V0H152c-13.255 0-24 10.745-24 24v368c0 13.255 10.745 24 24 24h272c13.255 0 24-10.745 24-24V128H344c-13.2 0-24-10.8-24-24zm120.971-31.029L375.029 7.029A24 24 0 0 0 358.059 0H352v96h96v-6.059a24 24 0 0 0-7.029-16.97z"></path> \
    </svg> \
    <span class="mytooltiptext">Copy to clipboard</span> \
  </button> \
  <style> \
.mytooltip{position:relative;display:inline-block;border-bottom:1px dotted black}.mytooltip .mytooltiptext{visibility:hidden;width:120px;background-color:#555;color:#fff;text-align:center;border-radius:6px;padding:5px 0;position:absolute;z-index:1;bottom:125%;left:50%;margin-left:-60px;opacity:0;transition:opacity 0.3s}.mytooltip .mytooltiptext::after{content:"";position:absolute;top:100%;left:50%;margin-left:-5px;border-width:5px;border-style:solid;border-color:#555 transparent transparent transparent}.mytooltip:hover .mytooltiptext{visibility:visible;opacity:1} \
  </style> \
</div> \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  {fdocserver} \
  let txtarea = this.parentElement.querySelector('textarea'); \
  let div = this.closest('.paragraph'); \
  if(!div.closest('.openblock')){div = div.parentElement} \
  let source = div.nextElementSibling; \
  let pre = source.querySelector('pre'); \
  let text = pre.textContent; \
  let lineCount = text.split('\n').length; \
  let tokens = this.nextSibling; \
  console.log('tokens: [' +tokens.data.trim()+']'); \
  if(tokens.data.trim()!=''){docserver(txtarea,text,tokens.data);} else {txtarea.firstChild.data=text;} \
  source.remove(); \
  tokens.remove(); \
  this.remove(); \
}"> \
]

:snippet: pass:a[ \
<div style="border: 1px solid #f0f0f0; border-bottom-color: #8a8d90; display: flex; align-items: flex-start;"> \
</div> \
<img hidden="true" src="invalid-image.jpg" onerror="{ \
  {freplace} \
  let block = this.closest('.openblock'); \
  let div = this.closest('.paragraph'); \
  let source = div.nextElementSibling; \
  let pre = source.querySelector('pre'); \
  let text = pre.textContent; \
  let lineCount = text.split('\n').length; \
  let tokens = this.nextSibling; \
  console.log('tokens: [' +tokens.data.trim()+']'); \
  console.log('before text: [' +text+']'); \
  text = replaceTokens(text, tokens.data.trim()); \
  pre.textContent = text; \
  console.log('after text: [' +text+']'); \
  console.log(block); \
  block.parentElement.insertBefore(pre,block); \
  block.remove(); \
}"> \
]







ifdef::env-github[]
endif::[]



[id='lab-intro']
= Lab Introduction

Start from here to familiarise yourself with the goals of this workshop and the scenario it is based on.

[type=walkthroughResource,serviceName=openshift]
.Invite System
****
[subs=attributes]
++++
<div style="padding-left: 20px">{docserver-status}<div>
++++
****

_Apache Camel_ keeps making major evolution steps improving its usability and reaching wider audiences. It also advances in delivering significant automation on _Kubernetes_ environments to provide cloud native integration.

{empty} +


[time=1]
[id="workshop-progression"]
== Tech and Workshop progression

This is a quick overview of the technologies included in the workshop and what to expect as you progress with the completion of the workshop.

{empty} +

=== Technology Stack

Red Hat® OpenShift® Container Platform, Red Hat OpenShift Data Foundation, Red Hat Application Foundations, and other tools can help automate the workflow of data ingestion, preparation, and management building data pipelines for hybrid cloud deployments that automate data processing upon acquisition.

* Red Hat Application Foundations

** **Red Hat build of Apache Camel**: Utilize the integration capabilities of Apache Camel and its vast component library in the Quarkus runtime, optimizing for peak application performance with fast start up time.

** **Red Hat streams for Apache Kafka**: Based on the Apache Kafka project, streams for Apache Kafka offers a distributed backbone that allows microservices and other applications to share data with extremely high throughput and extremely low latency.

* Red Hat Dev Spaces

* Red Hat OpenShift

* Red Hat OpenShift Data Foundation

{empty} +


=== Workshop progression

If you haven't used Apache Camel before, you'll see how lightweight and powerful it is. And now, easier than ever to get started.

The latest improvements in developer experience and clean constructs bring two main benefits. They make it simpler to use and maintain over time (something seasoned Camel developers really value) while also making it easy for newcomers to jump in and discover its versatility and power.

The workshop takes you on a journey. It starts with simple data flows to show how easy it is, then step by step introduces constructs for more complex scenarios.

As you move through the hands-on labs, the examples grow and show you how to apply best-practice architectures. Each new case needs more control, an area where experienced *Camel* developers shine.

Every lab step you finish adds real value to the platform being built. The further you go, the more powerful features you uncover. But it all starts with the clean simplicity of no-code building blocks that let anyone set up data flows from A to B.

{empty} +

image::images/workshop-progress-value.png[align="center", width=60%]


[time=1]
[id="workshop-goals"]
== Workshop goals

The list below summarises, among others, the main goals the workshop sets for you:

* *Get started with Camel* + 
Understand the basics of Camel and take your first steps. +
{empty} +

* *Be the Camel developer* + 
Experience first hand powerful _Camel_ tooling that accelerates the development process, and how the _Camel DSL_ (Domain Specific Language) can help you to implement advanced use cases. +
{empty} +

* *Understand different levels of control* + 
Familiarise yourself with simple/medium/advanced integrations use cases and how _Camel_ helps to accelerate their delivery. +
{empty} +

* *Evolve an architecture towards maturity* +
Understand the justification behind certain design/architecture principles. Experience hands-on how evolving a platform in the right direction delivers a future proof architecture. +
{empty} +

* *Play with an exciting collaboration use case* + 
Get to know the architecture of a collaboration platform, an increasingly needed capability, strategic for any industry/organisation, to connect internally and externally with colleagues and customers. +
{empty} +

=== Building blocks in Camel

_Apache Camel_ is unique in how you construct data flows and how you extend it by creating customized building blocks.

To help you get familiarized with the different constructs you can use in Camel, the figure below shows a simplified view of how they relate to each other.

image::images/new/camel-abstraction-levels.jpg[align="center", width=60%]

- A pipe is made out of Kamelets
- A Kamelet is the encapsulation of a Camel route
- A Camel route is made out of steps
- A step is tipically a Camel component (but also includes the use of EIPs or calls to other routes or Kamelets).

{empty} +

The workshop will center its attention around those most commonly used: _Kamelets_ and _Camel_ routes.

{empty} +



[time=1]
[id="scenario-intro"]
== Scenario introduction

As the internet evolves and technologies and trends emerge, so does the way people and organisations connect. Not only is digitalization transforming and automating processes, but also social changes and events are making an impact that is shaping how we interact.

Email and SMSs started to replace direct phone conversations, and soon instant messaging platforms gained popularity over them. Today we have a big landscape of messaging platforms and often we feel divided on which one to use to communicate with family and friends.

On the professional side, organisations mandate one common communication platform for all associates, but often, more than one survives, splitting work discussions between them.

It becomes even more inconvenient when a sales department, for example, needs to communicate with customers. Telephone / email are old fashioned channels that are no longer effective. Sales agents try to stay in close contact with their customers via instant messaging platforms, and of course, each customer uses a different one.

image::images/scenario-problem.png[align="center", width=40%]

In the picture above, the _Service Agent_ needs to manage multiple and diverse platform accounts in order to stay in contact with different customers.

The workshop proposes to build a platform that addresses this problem. It would integrate all platforms as one, and plug in additional services associated with those interactions. Additionally, the platform would provide new collaboration possibilities and new capabilities to help complying with government regulations, like data privacy and security.

The picture below illustrates a system that integrates all platforms and allows communication exchanges between different members from unrelated entities

image::images/scenario-message-hub.png[align="center", width=40%]

Under such solution, The _Service Agent_ would be abstracted from all external platforms and would simply be another member of the unified platform. 

{empty} +


[time=2]
[id='dev-environment']
== Development environment

The following instructions introduce you to your development environment, and the cluster where you'll deploy your applications throughout this workshop.

=== Overview

Built on the open Eclipse Che project, Red Hat OpenShift Dev Spaces uses Kubernetes and containers to provide any member of the development or IT team with a consistent, secure, and zero-configuration development environment. The experience is as fast and familiar as an integrated development environment on your laptop.

OpenShift Dev Spaces is included with your OpenShift subscription and is available in the Operator Hub. It provides development teams a faster and more reliable foundation on which to work, and it gives operations centralized control and peace of mind.


// [type=walkthroughResource,serviceName=codeready]
// .Red Hat OpenShift Dev Spaces
// ****
// * link:{codeready-url}[Console, window="_blank", , id="resources-codeready-url"]
// ****
// [type=walkthroughResource]
// .Red Hat OpenShift Developer Console
// ****
// * link:{openshift-host}/topology/ns/{namespace}[Topology View, window="_blank"]
// ****
// [type=walkthroughResource]
// .Credentials
// ****
// * *username:* `{user-username}`
// * *password:* `{user-password}`
// ****

[type=taskResource]
.Red Hat OpenShift Dev Spaces
****
* link:{codeready-url}[Console, window="_blank", , id="resources-codeready-url"]
****
[type=taskResource]
.Red Hat OpenShift Developer Console
****
* link:{openshift-host}/topology/ns/{namespace}[Topology View, window="_blank"]
****
[type=taskResource]
.Credentials
****
* *username:* `{user-username}`
* *password:* `{user-password}`
****

// :sectnums:
{empty} +

=== Accessing a Development Environment

The development environment you use throughout the workshop is a web-hosted IDE known as link:https://developers.redhat.com/products/codeready-workspaces/overview[Red Hat OpenShift Dev Spaces, window="_blank"].

{empty} +

=== Login to OpenShift Dev Spaces

To access your development environment:

. Click this link:{codeready-url}[Console, window="_blank"] link. +
(Also accessible from the *Resources* panel on the right, under *Red Hat OpenShift Dev Spaces*).

. You'll be first prompted to choose _OpenShift_ to log in. +
Click the button `Log in with OpenShift`:
+
image:images/000-codeready-login-with-ocp.png[align="left", width=40%]
+
{blank}
+
. Then, log in using your username (`{user-username}`) and password (`{user-password}`)
+
image:images/000-codeready-login.png[OpenShift Dev Spaces Login, role="integr8ly-img-responsive"]
+
{empty} +
+
. Next, authorise access, click `Allow selected permissions`
+
image::images/00-crw-dashboard-auth.png[align="left", width=50%]
+
{empty} +
+
Once you are logged in, you'll see the CodeReady dashboard. This lists available workspaces.
+
image::images/00-crw-dashboard.png[CodeReady Dashboard, role="integr8ly-img-responsive"]

{empty} +

=== Accessing your DevSpaces Workspace

This workshop provides a single, pre-configured workspace with plugins, source code, and even container images that have various Command-Line Interface (CLI) tools installed.

. Click the *Open* link for the workspace named `dayinthelife-workspace`.
+
image::images/001-open-workspace.png[Open CodeReady Workspace, role="integr8ly-img-responsive"]
+
{blank}
+
This will start an instance of the workspace. Please wait a few moments while it downloads the required container images and configuration setup.
+
{empty} +

. When the IDE appears:
+
Ensure you click `Yes, I trust the authors` when the following message shows on your screen:
+
image::images/crw-trust-project.png[Trust Workshop Project, role="integr8ly-img-responsive", align="left", width=50%]
+
{empty} +

. Close the `welcome` tab by clicking the *x*. +
The Explorer shows you the *MESSAGE-HUB* folder where you will be working.
+
image::images/01-crw-welcome.png[CodeReady Welcome screen, role="integr8ly-img-responsive"]
+
[NOTE]
====
This IDE is based on _Microsoft VSCode_. It will look familiar if you have already used it.
====
+
{empty} +

=== Accessing a Terminal

During the workshop you will use the OpenShift CLI along with other developer-focused Command Line Interface (CLI) tools.
These CLI tools are available directly inside your Workspace via tools containers.

Access the *tools* container(s) like so:

. Click on the _hamburger-icon_ button on the upper-left corner of your IDE.
. Then, select *Terminal* -> *New Terminal*.
+
{blank}
+
image::images/02-crw-tools-container.png[Open Terminal, role="integr8ly-img-responsive"]
+
{blank}
+
A terminal window should open at the bottom of the screen. This terminal is attached to the running tools container and is also running on _OpenShift_. This is the place where you will issue most of the commands from this workshop.

{empty} +

=== Login into OpenShift using the CLI

. Open a terminal using the instructions from the previous section.


. In the terminal tab, issue the following command:
+
[source,bash,subs=attributes]
----
oc project {namespace}
----
+
{blank}
+
[TIP]
====
* To copy the content of snippets of code, as above, click on the copy button on the right side of snippet box.
* Perform the same copy action for other snippets along the workshop to complete the exercises.
====

. You should see something like the following:
+
[subs="attributes+"]
----
message-hub (main) $ oc project {namespace}
Now using project "{user-username}" on server "https://172.30.0.1:443".
message-hub (main) $ 
----
+
{empty} +
+
. Most of the work will be deployed into your own `{namespace}` project namespace.

{empty} +



[type=verification]
Did your terminal show you are connected to _OpenShift_ and pointing to the project `{namespace}`?

[type=verificationFail]
Make sure you follow the commands above. Try again.

[type=verificationSuccess]
You are now ready to start working !


